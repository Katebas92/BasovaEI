<!DOCTYPE html>
<html>
<head>
    <title>Крестики-нолики</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
        }
        td {
            border: 1px solid #000;
            width: 50px;
            height: 50px;
            font-size: 36px;
        }
        input, button {
            padding: 8px;
            margin: 5px;
        }
        .container {
            max-width: 300px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Крестики-нолики</h1>

        <?php
        // Инициализация переменных
        session_start();
        if (!isset($_SESSION['board'])) {
            $_SESSION['board'] = array_fill(0, 3, array_fill(0, 3, ' '));
            $_SESSION['current_player'] = 'X';
            $_SESSION['player_x'] = '';
            $_SESSION['player_o'] = '';
            $_SESSION['game_over'] = false;
            $_SESSION['winner'] = '';
        }

        // Обработка хода
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            if (isset($_POST['restart'])) {
                $_SESSION['board'] = array_fill(0, 3, array_fill(0, 3, ' '));
                $_SESSION['current_player'] = 'X';
                $_SESSION['game_over'] = false;
                $_SESSION['winner'] = '';
                $_SESSION['player_x'] = $_POST['player_x'] ?? '';
                $_SESSION['player_o'] = $_POST['player_o'] ?? '';
            } elseif (isset($_POST['row'], $_POST['col']) && !$_SESSION['game_over']) {
                $row = (int)$_POST['row'] - 1;
                $col = (int)$_POST['col'] - 1;
                if ($row >= 0 && $row < 3 && $col >= 0 && $col < 3 && $_SESSION['board'][$row][$col] === ' ') {
                    $_SESSION['board'][$row][$col] = $_SESSION['current_player'];
                    if (check_winner($_SESSION['board'], $_SESSION['current_player'])) {
                        $_SESSION['game_over'] = true;
                        $_SESSION['winner'] = $_SESSION['current_player'];
                    } elseif (is_full($_SESSION['board'])) {
                        $_SESSION['game_over'] = true;
                    } else {
                        $_SESSION['current_player'] = $_SESSION['current_player'] === 'X' ? 'O' : 'X';
                    }
                }
            }
        }

        // Функции проверки
        function check_winner($board, $player) {
            for ($i = 0; $i < 3; $i++) {
                if ($board[$i][0] === $player && $board[$i][1] === $player && $board[$i][2] === $player) return true;
                if ($board[0][$i] === $player && $board[1][$i] === $player && $board[2][$i] === $player) return true;
            }
            if ($board[0][0] === $player && $board[1][1] === $player && $board[2][2] === $player) return true;
            if ($board[0][2] === $player && $board[1][1] === $player && $board[2][0] === $player) return true;
            return false;
        }

        function is_full($board) {
            foreach ($board as $row) {
                foreach ($row as $cell) {
                    if ($cell === ' ') return false;
                }
            }
            return true;
        }
        ?>

        <!-- Форма для имён игроков и кнопка "Начать заново" -->
        <form method="post">
            <input type="text" name="player_x" placeholder="Имя игрока X" value="<?= htmlspecialchars($_SESSION['player_x']) ?>" required>
            <input type="text" name="player_o" placeholder="Имя игрока O" value="<?= htmlspecialchars($_SESSION['player_o']) ?>" required>
            <button type="submit" name="restart">Начать заново</button>
        </form>

        <!-- Статус игры -->
        <div>
            <?php if ($_SESSION['game_over']): ?>
                <?= $_SESSION['winner'] ? "Игрок " . ($_SESSION['winner'] === 'X' ? $_SESSION['player_x'] : $_SESSION['player_o']) . " победил!" : "Ничья!" ?>
                <form method="post"><button type="submit" name="restart">Сыграть ещё раз</button></form>
            <?php else: ?>
                Ход игрока <?= $_SESSION['current_player'] === 'X' ? $_SESSION['player_x'] : $_SESSION['player_o'] ?> (<?= $_SESSION['current_player'] ?>)
            <?php endif; ?>
        </div>

        <!-- Игровое поле -->
        <table>
            <?php for ($i = 0; $i < 3; $i++): ?>
                <tr>
                    <?php for ($j = 0; $j < 3; $j++): ?>
                        <td><?= htmlspecialchars($_SESSION['board'][$i][$j]) ?></td>
                    <?php endfor; ?>
                </tr>
            <?php endfor; ?>
        </table>

        <!-- Форма для хода -->
        <?php if (!$_SESSION['game_over']): ?>
            <form method="post">
                <input type="number" name="row" placeholder="Строка (1-3)" min="1" max="3" required>
                <input type="number" name="col" placeholder="Столбец (1-3)" min="1" max="3" required>
                <button type="submit">Сделать ход</button>
            </form>
        <?php endif; ?>
    </div>
</body>
</html>
